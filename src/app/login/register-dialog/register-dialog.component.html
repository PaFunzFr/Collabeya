<section class="register-dialog">
  <div class="register-content">
    <img
      src="/assets/icons/login/arrow-back-black.svg"
      alt="Arrow back"
      class="back-to-login"
      (click)="signalService.backToLogin()"
    />
    <h2>Create Account</h2>

    <span class="register-info">
      Get your own DABubble-account with your name and mail-address
    </span>

    <form
      #contactForm="ngForm"
      class="form-login"
    >
      <div class="input-wrapper">
        <div class="name-input-wrapper">
          <input
            #name="ngModel"
            [(ngModel)]="nameInput"
            type="text"
            class="input"
            id="name"
            name="name"
            required
            pattern="^[A-Za-zÄÖÜäöüß]+(?:\s+[A-Za-zÄÖÜäöüß]+)+$"
            placeholder="First and last name"
          />
          <div class="icon">
            <img src="./assets/icons/login/name_black.svg" alt="User Icon" />
          </div>
          @if (name.touched && name.invalid) {
          <span class="error-message">Please enter a first and last name</span>
          } @else {<span class="error-message-placeholder"></span> }
        </div>

        <div class="mail-input-wrapper">
          <input
            #email="ngModel"
            [(ngModel)]="emailInput"
            type="text"
            class="input"
            id="mail"
            name="email"
            required
            pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}"
            placeholder="Email"
          />
          <div class="icon">
            <img src="./assets/icons/login/mail_black.svg" alt="Mail Icon" />
          </div>
          @if (email.touched && email.invalid) {
          <span class="error-message">Please enter a valid mail address</span>
          } @else {<span class="error-message-placeholder"></span> }
        </div>

        <div class="password-input-wrapper">
          <input
            #password="ngModel"
            [(ngModel)]="passwordInput"
            [type]="passwordVisible ? 'text' : 'password'"
            class="input"
            id="password"
            name="password"
            required
            pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$"
            placeholder="Password"
          />

          @if (!passwordInput) {
          <div class="icon">
            <img
              src="./assets/icons/login/lock_black.svg"
              alt="Password Icon"
            />
          </div>
          } @if (passwordInput) {
          <div class="icon" (click)="passwordService.togglePasswordVisibility(passwordVisible)">
            <img
              [src]="
                passwordVisible
                  ? './assets/icons/login/visibility.svg'
                  : './assets/icons/login/visibility_off.svg'
              "
            />
          </div>
          } @if (password.touched && password.invalid) {
          <span class="error-message"
            >Please enter at least 8 characters, including uppercase, lowercase,
            number, and special character.</span
          >
          } @else {<span class="error-message-placeholder"></span>
          }
        </div>

        <div class="password-input-wrapper">
        <input
          #confirmPassword="ngModel"
          [(ngModel)]="confirmPasswordInput"
          [type]="confirmPasswordVisible ? 'text' : 'password'"
          class="input"
          id="confirmPassword"
          name="confirmPassword"
          required
          placeholder="Confirm New Password"
        />

        @if (!confirmPasswordInput) {
        <div class="icon">
          <img src="./assets/icons/login/lock_black.svg" alt="Password Icon" />
        </div>
        } @if (confirmPasswordInput) {
        <div class="icon" (click)="passwordService.toggleConfirmPasswordVisibility(confirmPasswordVisible)">
          <img
            [src]="
              confirmPasswordVisible
                ? './assets/icons/login/visibility.svg'
                : './assets/icons/login/visibility_off.svg'
            "
          />
        </div>
        } @if (confirmPasswordInput && !passwordService.passwordsMatch) {
        <span class="error-message">Passwords do not match.</span>
        } @else {
        <span class="error-message-placeholder"
          >Passwords do not match.</span
        >
        } @if (password.touched && password.invalid) {
        <span class="error-message-password"
          >Please enter at least 8 characters, including uppercase, lowercase,
          number, and special character.</span
        >
        }
      </div>

        <div class="privacy-policy-wrapper">
          <label for="privacy-policy-checkbox">
            <input
              type="checkbox"
              name="checkbox"
              id="privacy-policy-checkbox"
              [checked]="privacyPolicyAccepted"
              (change)="privacyPolicyAccepted = !privacyPolicyAccepted"
              required
            />
            <span class="checkmark"></span>
            <span class="checkbox-text"
              >I accept the
              <a routerLink="/privacy-policy" class="privacy-policy-link"
                >Privacy Policy</a
              >
            </span>
          </label>
        </div>

        <div class="apply-button-wrapper">
          <button
            class="apply-button"
            type="submit"
            [disabled]="
              !name.valid ||
              !email.valid ||
              !password.valid ||
              !privacyPolicyAccepted
            "
            (click)="
              createUser(this.nameInput, this.emailInput, this.confirmPasswordInput)
            "
          >
            Apply
          </button>
        </div>
      </div>
    </form>
  </div>
</section>
